<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Tutorials</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Tutorials</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="tutorials.html">Tutorials</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Tutorials</h1>

</div>


<div id="stra-b-gene-analysis" class="section level1">
<h1>StrA-B Gene Analysis</h1>
<p>This is a test to see if I can embed R code</p>
<pre class="r"><code>library(tidyverse)
library(ape)
library(ggplot2)
library(grid)
library(plyr)
library(reshape)
library(reshape2)
library(ggthemes)
library(gridExtra)
library(corrplot)
library(dplyr)
library(vegan)
library(SpadeR)

library(RColorBrewer)
library(phyloseq)

library(DESeq2)


darte_ed_16s &lt;- import_mothur(mothur_shared_file = &quot;~/Desktop/stability.opti_mcc.shared&quot;, mothur_constaxonomy_file = &quot;~/Desktop/stability.cons.taxonomy&quot;)


metadata &lt;- read.csv(&quot;~/Desktop/16slabels.csv&quot;, row.names=1)
sample &lt;- sample_data(metadata)
sample_data(darte_ed_16s)&lt;- sample

# set rarefying depth
after_remove_low_depth &lt;- prune_samples(sample_sums(darte_ed_16s) &gt;= 400, darte_ed_16s)
sample_sums(after_remove_low_depth)</code></pre>
<pre><code>## AH105OBT1S2R3 AH106OBT1S2R1      AH109MT2      AH110MT2      AH111MT2 
##           515           619         22510         24628         23400 
##      AH112MT2      AH113MT2      AH114MT2      AH115MT2      AH116MT2 
##         19082          2126          4401         34824         34179 
##      AH117MT2      AH118MT2 AH262LPT3S2R3 AH268OPT3S1R3 AH269OPT3S1R1 
##         33516         95186         36083          8379         23777 
## AH270OPT3S1R2 AH276OPT3S1R2 AH277OPT3S1R3 AH278OPT3S1R1 AH282OPT3S1R2 
##         48804          7164         12031         61246           923 
## AH284OPT3S1R1 AH285OPT3S1R2 AH286OPT3S1R3 AH292OPT3S1R3 AH293OPT3S1R1 
##          2081         40272          1030          3260         26172 
## AH294OPT3S1R2 AH295OPT3S1R3 AH297OPT3S1R2 AH300OPT3S2R2 AH301OPT3S2R3 
##        169120          1883         15028          8627          2299 
## AH302OPT3S2R1 AH305OPT3S2R1 AH308OPT3S2R1 AH309OPT3S2R2 AH310OPT3S2R3 
##         12490          3910         16207         11080         18069 
## AH311OPT3S2R1 AH313OPT3S2R3 AH317OPT3S2R1 AH318OPT3S2R2 AH321OPT3S2R2 
##          5770          5230         72037         92541         17774 
## AH322OPT3S2R3 AH324OPT3S2R2 AH325OPT3S2R3 AH326OPT3S2R1 AH327OPT3S2R2 
##           589          7760         12697        127552         11830 
## AH329OPT3S2R1 AH330OPT3S2R2 AH331OPT3S2R3 AH332OPT3S2R1 AH334OPT3S2R3 
##          7761         46289         10187         25934          6363 
## AH38POBT1S1R2 AH45POBT1S1R3 AH48POBT1S1R3 AH54POBT1S1R3  AH61OBT1S1R1 
##           413          1853           718           408           936 
##  AH62OBT1S1R2  AH66OBT1S1R3  AH67OBT1S1R1  AH68OBT1S1R2  AH69OBT1S1R3 
##           622          1893           683          2247          1197 
##  AH70OBT1S1R1  AH71OBT1S1R2  AH72OBT1S1R3  AH81OBT1S2R3  AH83OBT1S2R2 
##          1042          2785           587           435           971 
##  AH84OBT1S2R3  AH89OBT1S2R2  AH92OBT1S2R2  AH93OBT1S2R3  AH95OBT1S2R2 
##          1281           543          2683          1963           726</code></pre>
<pre class="r"><code>set.seed(1)
rare &lt;- rarefy_even_depth(after_remove_low_depth, sample.size = 400,rngseed=TRUE)</code></pre>
<pre><code>## `set.seed(TRUE)` was used to initialize repeatable random subsampling.</code></pre>
<pre><code>## Please record this for your records so others can reproduce.</code></pre>
<pre><code>## Try `set.seed(TRUE); .Random.seed` for the full vector</code></pre>
<pre><code>## ...</code></pre>
<pre><code>## 15128OTUs were removed because they are no longer 
## present in any sample after random subsampling</code></pre>
<pre><code>## ...</code></pre>
<pre class="r"><code>sample_sums(rare)</code></pre>
<pre><code>## AH105OBT1S2R3 AH106OBT1S2R1      AH109MT2      AH110MT2      AH111MT2 
##           400           400           400           400           400 
##      AH112MT2      AH113MT2      AH114MT2      AH115MT2      AH116MT2 
##           400           400           400           400           400 
##      AH117MT2      AH118MT2 AH262LPT3S2R3 AH268OPT3S1R3 AH269OPT3S1R1 
##           400           400           400           400           400 
## AH270OPT3S1R2 AH276OPT3S1R2 AH277OPT3S1R3 AH278OPT3S1R1 AH282OPT3S1R2 
##           400           400           400           400           400 
## AH284OPT3S1R1 AH285OPT3S1R2 AH286OPT3S1R3 AH292OPT3S1R3 AH293OPT3S1R1 
##           400           400           400           400           400 
## AH294OPT3S1R2 AH295OPT3S1R3 AH297OPT3S1R2 AH300OPT3S2R2 AH301OPT3S2R3 
##           400           400           400           400           400 
## AH302OPT3S2R1 AH305OPT3S2R1 AH308OPT3S2R1 AH309OPT3S2R2 AH310OPT3S2R3 
##           400           400           400           400           400 
## AH311OPT3S2R1 AH313OPT3S2R3 AH317OPT3S2R1 AH318OPT3S2R2 AH321OPT3S2R2 
##           400           400           400           400           400 
## AH322OPT3S2R3 AH324OPT3S2R2 AH325OPT3S2R3 AH326OPT3S2R1 AH327OPT3S2R2 
##           400           400           400           400           400 
## AH329OPT3S2R1 AH330OPT3S2R2 AH331OPT3S2R3 AH332OPT3S2R1 AH334OPT3S2R3 
##           400           400           400           400           400 
## AH38POBT1S1R2 AH45POBT1S1R3 AH48POBT1S1R3 AH54POBT1S1R3  AH61OBT1S1R1 
##           400           400           400           400           400 
##  AH62OBT1S1R2  AH66OBT1S1R3  AH67OBT1S1R1  AH68OBT1S1R2  AH69OBT1S1R3 
##           400           400           400           400           400 
##  AH70OBT1S1R1  AH71OBT1S1R2  AH72OBT1S1R3  AH81OBT1S2R3  AH83OBT1S2R2 
##           400           400           400           400           400 
##  AH84OBT1S2R3  AH89OBT1S2R2  AH92OBT1S2R2  AH93OBT1S2R3  AH95OBT1S2R2 
##           400           400           400           400           400</code></pre>
<pre class="r"><code>#remove NTC
to_remove &lt;- c(&quot;NTC&quot;)
pruned &lt;- prune_samples(!(rownames(sample_data(rare)) %in% to_remove), rare)

group_bar_chart &lt;- function(physeq){
  fin_table  = data.frame()
  for (group in unique(sample_data(physeq)$DT) ){
    temp_physeq = prune_samples( (sample_data(physeq)$DT == group), physeq)
    
    new_table &lt;- data.frame(taxa_sums(temp_physeq), tax_table(temp_physeq)[,2])
    colnames(new_table) = c(&quot;abundance&quot;, &quot;phylum&quot;)
    sum_table = data.frame()
    for (x in unique(new_table$phylum) ){
      temp = subset(new_table, phylum==x)
      su = sum(temp$abundance)
      sum_table = rbind(sum_table, data.frame(su, temp[1,2]))
    }
    
    colnames(sum_table) = c(&quot;abundance&quot;, &quot;phylum&quot;)
    perc_table = sum_table
    for (i in 1:nrow(sum_table)){
      perc_table[i,1] = sum_table[i,1] / sum(sum_table[,1])
    }
    
    other_table = data.frame()
    other = c()
    for (i in 1:nrow(perc_table)){
      if(perc_table[i,1] &gt; 0.01) {
        other_table = rbind(other_table, perc_table[i,])
      }else{
        other = c(other, perc_table[i,1])
      }
    }
    
    sum(other)
    tep = data.frame(sum(other), &quot;other&quot;)
    colnames(tep) = c(&quot;abundance&quot;, &quot;phylum&quot;)
    tfin = rbind(other_table, tep)
    ttfin = cbind(tfin,group)
    fin_table = rbind(fin_table, ttfin)
    phy = unique(fin_table$phylum)
  }
  return(fin_table)
}

fin_table &lt;- group_bar_chart(pruned)
fin_table$group = factor(fin_table$group, levels = c(&quot;11/8/2016 Soil&quot;,&quot;11/12/2016 Manure&quot; ,&quot;11/15/2016 Manure Line&quot;,&quot;11/15/2016 Soil&quot;))
(p &lt;- ggplot(fin_table, aes(x=group,y=abundance, fill=phylum))+geom_bar(stat=&quot;identity&quot;,color=&quot;black&quot;)+labs(y=&quot;relative abundance&quot;)+ scale_fill_hue()+theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1)))</code></pre>
<p><img src="tutorials_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
