<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Gene Diversity Analysis Tutorial</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Edward Lopatto</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Front Door</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="community_tutorial.html">16s Community Analysis</a>
    </li>
    <li>
      <a href="str_tutorial.html">str Gene Variant Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="helpful_references.html">Helpful References</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Gene Diversity Analysis Tutorial</h1>

</div>


<div id="stra-b-gene-analysis" class="section level1">
<h1>StrA-B Gene Analysis</h1>
<div id="background" class="section level2">
<h2>Background</h2>
<p>This is a small project that practices fetching data from databases and annotating metagenomes. In this tutorial, I analyze the genes <em>strA</em> and <em>strB</em>, but you can choose other genes. I follow the paper <a href="https://academic.oup.com/femsec/article/94/4/fiy006/4810543"><em>Practical implications of erythromycin resistance gene diversity on surveillance and monitoring of resistance</em></a> from Choi et al. (2018).</p>
<p>There is a lot of bioinformatic assumptions that this workflow is based on and I will try to explain them as I go. You may disagree with some of them, and thats OK. I challenge you to try it your way, compare your results with mine, and then convince me why your way is advantageous.</p>
<p>Things you will need:</p>
<ul>
<li>AWS instance (see EDAMAME in references if you need help) or high performance computer</li>
<li>Knowledge of bash</li>
<li>FileZilla or another way to transfer files</li>
<li>Preassembled metagenomes (You can assemble new metagenomes, but that will add two months to this project)</li>
<li>Various Programs: NCBI blast, CD-HIT, FastTree, and various scripts (but I will help install now)</li>
</ul>
</div>
<div id="program-downloads" class="section level2">
<h2>Program downloads</h2>
<p>Links to programs you will need</p>
<ul>
<li></li>
<li><a href="https://github.com/weizhongli/cdhit/releases">CD-HIT</a>.</li>
</ul>
<pre><code>#Download and unzip CD-HIT
wget link sequences
tar xvf cd-hit-2006-0215.tar.gz --gunzip
cd cd-hit-2006
#compile
make</code></pre>
</div>
<div id="fetching" class="section level2">
<h2>Fetching</h2>
<p>Go to <a href="http://fungene.cme.msu.edu/">RDP fungene repository</a> and pick your favorite gene(s). It is better to work with the Resfams if your gene has one. <em>strA-B</em> don’t have a Resfam so I just used the respective gene links. Filter your genes. Odds are you have many hits, so you want to narrow down the genes to the ones that are more likely to convey resistance. I set the HMM threshold to 97%. Once you have done quality control, select all the sequences, and click “begin analysis”. Select “nucleotide download”, unclick “align”, and download the sequences.</p>
<p>Make a directory called sequences, and move these sequences that directory. Then combine them into one file.</p>
<pre><code>#make directory and navigate to it
mkdir sequences
cd sequences

#combine files
cat * &gt; allseqs</code></pre>
</div>
<div id="clustering" class="section level2">
<h2>Clustering</h2>
<p>Now we need to cluster the sequences using CD-HIT, to make analysis easier. [Here is a good guide]((<a href="http://www.bioinformatics.org/cd-hit/cd-hit-user-guide.pdf" class="uri">http://www.bioinformatics.org/cd-hit/cd-hit-user-guide.pdf</a>) on how to use it.</p>
<pre><code>#Run CD-HIT
cd-hit -i allseqs -o db99 -c 0.99 -n 5</code></pre>
<p>where allseqs is the filename of input, db99 is output, 0.99, means 99% identity, is the clustering threshold 5 is the size of word</p>
<p>Choose of word size: -n 5 for thresholds 0.7 ~ 1.0 -n 4 for thresholds 0.6 ~ 0.7 -n 3 for thresholds 0.5 ~ 0.6 -n 2 for thresholds 0.4 ~ 0.5</p>
<p><em>Question: Why cluster at 99%?</em> <em>Answer: It makes justification of later analysis easier. I will explain better later, but a good exercise is to graph the number of clusters at different cutoff thresholds. The graph will tell you a lot about the variation within the gene, and maybe that 99% threshold isn’t good.</em></p>
<p>For later analysis, we need a spreadsheet numbering the cluters. Open up db99 in excel and using delimiters isolate the accession number. Number them from 1 to 91. Save this as clusters.csv.</p>
</div>
<div id="alignment" class="section level2">
<h2>Alignment</h2>
<p>Now that we have 91 clusters, we will use these clusters as representatives of our gene which makes are queries shorter. I use <a href="https://www.ebi.ac.uk/Tools/msa/muscle/">MUSCLE</a> to align the sequences. Because we have less than 500 clusters, we can use the website. If you have more than 500 clusters, you will need to download MUSCLE on your server or try a different cluster threshold.</p>
<p>Transfer your clustered sequences fasta file (db99) and input it into MUSCLE. Sit back and wait for the magic to happen. Once it finishes, download the aligned file and put in back onto your instance.</p>
</div>
<div id="phylogenetic-tree" class="section level2">
<h2>Phylogenetic tree</h2>
<p>We use FastTree to make a tree file.</p>
<pre><code>FastTree -gtr -nt &lt; alignment.file &gt; tree_file</code></pre>
<p>Take your tree_file and put it onto your computer. We will visualize and annotate it in R.</p>
</div>
<div id="primer-search" class="section level2">
<h2>Primer search</h2>
<p>So you have gathered published primer sequences and want to know how well they can amplify this gene. Put them into fasta format.</p>
<pre><code>#example primer fasta
&gt;F1
agtcctcgaaggccttttaa
&gt;R1
aggggtccatacgcgcaagt</code></pre>
<p>For our purposes, we will consider a primer to amplify a cluster if both forward and reverse primers were required to share 100% nucleotide similarity over a minimum of 17 bp of the primer length.</p>
<p><em>Question: Why 100% similarity? Can’t primers work if they are off by only one nucleotide or even sometimes more?</em> <em>Answer: Yes. However, it is hard to predict how primers behave. We are being very conservative in our estimates. Given that our clusters already have small variation within in them, allowing one nucleotide difference in the primer makes finding matches even more complicated.</em></p>
<p>Luckily, Jin has a script that does this.</p>
<pre><code>python jinscript.py input output</code></pre>
<p>Now we have what clusters are hit by which primer. Using clusters.csv and r, we can merge documents to also gain the cluster number. Make an excel sheet with each primer, the cluster numbers they hit, and the cluster accessions.</p>
<p>Go back to R and plot the tree (see Phylogenetic tree section). We can add the new meta data to the figure like this.</p>
<pre><code>Annotated tree plot</code></pre>
</div>
<div id="taxonomy" class="section level2">
<h2>Taxonomy</h2>
<p>We want to examine the host taxonomy of the gene variants. Unlike before, I want the taxonomy of all the sequences - not just the clusters. Luckily, there is a script to fetch taxonomy.</p>
<p>Analysis</p>
</div>
<div id="metagenomic-annotation-and-analysis" class="section level2">
<h2>Metagenomic Annotation and Analysis</h2>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
